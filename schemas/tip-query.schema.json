{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://tezit.com/spec/v1.2/tip-query.schema.json",
  "title": "TIP Interrogation Query Schema",
  "description": "JSON Schema for a Tez Interrogation Protocol (TIP) query request. Defines the structure of a query submitted to an interrogation session endpoint. Queries are natural-language questions or instructions directed at the Tez bundle's context materials. All responses to TIP queries are grounded exclusively in the transmitted context.",
  "type": "object",
  "required": ["query"],
  "properties": {
    "query": {
      "type": "string",
      "description": "The natural-language question or instruction about the Tez content. Queries that ask about topics outside the bundle's scope will result in an abstention response, not a general-knowledge answer.",
      "minLength": 1,
      "maxLength": 10000,
      "examples": [
        "What does the budget say about infrastructure costs?",
        "Is the claim about 18% cost overrun supported by the data?",
        "How does Q3 revenue compare to Q4?",
        "Show me the exact source for the $127,500 cost estimate."
      ]
    },
    "session_id": {
      "type": "string",
      "description": "Identifier of the active interrogation session. If omitted, the server determines the session from the URL path.",
      "pattern": "^tip-sess-[a-zA-Z0-9]+$",
      "examples": ["tip-sess-a1b2c3d4e5f6"]
    },
    "max_tokens": {
      "type": "integer",
      "description": "Maximum number of tokens to generate in the response. Overrides the session default if specified.",
      "minimum": 100,
      "maximum": 16000,
      "default": 2000,
      "examples": [2000, 4000]
    },
    "response_format": {
      "type": "string",
      "description": "Desired format for the response. 'markdown' is the default and includes inline citations. 'structured' returns a machine-readable JSON object with separated text, citations, and metadata.",
      "enum": ["markdown", "structured", "plain"],
      "default": "markdown",
      "examples": ["markdown", "structured"]
    },
    "grounding_mode": {
      "type": "string",
      "description": "Controls how strictly the response is grounded. 'strict' prohibits all inference and requires direct citations for every claim. 'standard' permits labeled inferences alongside grounded claims. 'exploratory' allows broader inference with clear labeling (useful for gap analysis queries).",
      "enum": ["strict", "standard", "exploratory"],
      "default": "standard",
      "examples": ["strict", "standard"]
    },
    "preferences": {
      "type": "object",
      "description": "Optional per-query preferences that override session defaults.",
      "properties": {
        "confidence_signals": {
          "type": "boolean",
          "description": "Whether to include confidence signals (high/medium/low) in the response.",
          "default": true
        },
        "citation_style": {
          "type": "string",
          "description": "Citation display style preference.",
          "enum": ["inline", "footnote", "block"],
          "default": "inline"
        },
        "include_gaps": {
          "type": "boolean",
          "description": "Whether to explicitly list information gaps in the response.",
          "default": true
        },
        "language": {
          "type": "string",
          "description": "Preferred response language as a BCP 47 tag. The system will attempt to respond in this language.",
          "examples": ["en", "fr", "ja"]
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "query": "What does the budget say about infrastructure costs?",
      "max_tokens": 2000,
      "response_format": "markdown",
      "grounding_mode": "standard"
    },
    {
      "query": "Show me the exact source for the $127,500 cost estimate.",
      "max_tokens": 4000,
      "response_format": "structured",
      "grounding_mode": "strict",
      "preferences": {
        "confidence_signals": true,
        "citation_style": "inline"
      }
    }
  ]
}
